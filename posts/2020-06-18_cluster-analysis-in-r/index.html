<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Mitchell">
<meta name="dcterms.date" content="2020-06-18">
<meta name="description" content="I recently gave a small talk on some packages I like using for doing clustering analysis in R. Here’s a brief introduction to some features of factoextra and NbClust">

<title>Clustering analysis in R, with factoextra and NbClust – Andrew Mitchell</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Clustering analysis in R, with factoextra and NbClust – Andrew Mitchell">
<meta property="og:description" content="I recently gave a small talk on some packages I like using for doing clustering analysis in R. Here’s a brief introduction to some features of factoextra and NbClust">
<meta property="og:image" content="https://drandrewmitchell.com/posts/2020-06-18_cluster-analysis-in-r/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta property="og:site_name" content="Andrew Mitchell">
<meta name="twitter:title" content="Clustering analysis in R, with factoextra and NbClust – Andrew Mitchell">
<meta name="twitter:description" content="I recently gave a small talk on some packages I like using for doing clustering analysis in R. Here’s a brief introduction to some features of factoextra and NbClust">
<meta name="twitter:image" content="https://drandrewmitchell.com/posts/2020-06-18_cluster-analysis-in-r/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta name="twitter:creator" content="@acousticsman">
<meta name="twitter:site" content="@acousticsman">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Andrew Mitchell</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-research" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Research</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-research">    
        <li>
    <a class="dropdown-item" href="../../research/papers.html">
 <span class="dropdown-text">Open Source Papers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../research/presentations.html">
 <span class="dropdown-text">Talks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../research/list-of-pubs.html">
 <span class="dropdown-text">List of Publications</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/MitchellAcoustics/quarto-website">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/MitchellAcoustics/quarto-website/issues">
            Report a bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Clustering analysis in R, with <code>factoextra</code> and <code>NbClust</code></h1>
                  <div>
        <div class="description">
          <p>I recently gave a small talk on some packages I like using for doing clustering analysis in R. Here’s a brief introduction to some features of factoextra and NbClust</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">soundscape</div>
                <div class="quarto-category">PhD</div>
                <div class="quarto-category">machine learning</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://drandrewmitchell.com/">Andrew Mitchell</a> <a href="https://orcid.org/0000-0003-0978-5046" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.ucl.ac.uk/bartlett/construction/">
              BSSC @ University College London
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 18, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#clustering-analysis-libraries" id="toc-clustering-analysis-libraries" class="nav-link active" data-scroll-target="#clustering-analysis-libraries">Clustering Analysis Libraries</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#calculate-the-mean-value-for-each-location" id="toc-calculate-the-mean-value-for-each-location" class="nav-link" data-scroll-target="#calculate-the-mean-value-for-each-location">Calculate the mean value for each Location</a></li>
  <li><a href="#clustering-analysis" id="toc-clustering-analysis" class="nav-link" data-scroll-target="#clustering-analysis">Clustering Analysis</a>
  <ul>
  <li><a href="#some-standard-single-indices" id="toc-some-standard-single-indices" class="nav-link" data-scroll-target="#some-standard-single-indices">Some standard, single indices</a></li>
  <li><a href="#indices-using-nbclust" id="toc-indices-using-nbclust" class="nav-link" data-scroll-target="#indices-using-nbclust">30 indices using NbClust</a></li>
  </ul></li>
  <li><a href="#methods-i-havent-really-tested-out-thoroughly" id="toc-methods-i-havent-really-tested-out-thoroughly" class="nav-link" data-scroll-target="#methods-i-havent-really-tested-out-thoroughly">Methods I haven’t really tested out thoroughly</a>
  <ul>
  <li><a href="#fviz_silhouette" id="toc-fviz_silhouette" class="nav-link" data-scroll-target="#fviz_silhouette"><code>fviz_silhouette()</code></a></li>
  <li><a href="#get_clust_tendency" id="toc-get_clust_tendency" class="nav-link" data-scroll-target="#get_clust_tendency"><code>get_clust_tendency</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="clustering-analysis-libraries" class="level2">
<h2 class="anchored" data-anchor-id="clustering-analysis-libraries">Clustering Analysis Libraries</h2>
<p><code>factoextra</code>:</p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/factoextra/versions/1.0.3">https://www.rdocumentation.org/packages/factoextra/versions/1.0.3</a></li>
</ul>
<p><code>NbClust</code>:</p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/NbClust/versions/3.0">https://www.rdocumentation.org/packages/NbClust/versions/3.0</a></li>
<li><a href="https://www.jstatsoft.org/article/view/v061i06/v61i06.pdf">https://www.jstatsoft.org/article/view/v061i06/v61i06.pdf</a></li>
</ul>
<p>There are many libraries and functions in R for performing clustering analysis, so why look at these 2? Well, they solve two important challenges with clustering: visualisation and determining the optimal number of clusters.</p>
<p>In general, cluster analysis is an unsupervised machine learning task, meaning we don’t predefine a target output for the learning. For clustering, this mainly means that we don’t know what the categories will be before we start the analysis. We also don’t know how many clusters are present.</p>
<p>Many indices have been created to help with determining the optimal number of clusters, however these each have their own advantages and disadvantages and often give conflicting results. We’ll demonstrate this by looking at the results from three popular graphical methods: elbow plot, silhouette, and gap statistic.</p>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>We’ll be looking at data from the <a href="https://www.mdpi.com/2076-3417/10/7/2397">Soundscape Indices (SSID) Database</a>. This dataset contains data in-situ perceptual assessments of urban soundscapes, paired with acoustic and environmental data. For this set, we’ll be looking at the perceptual data only.</p>
<p>To collect the data, random members of the public were approached while in urban public spaces and asked to take a survey about how they perceive the sound environment. A section of the questions ask specifically about the perceived dominance of sound sources in the space. Sound sources are categorized as Traffic noise, Other noise, Human sounds, Natural sounds, and are rated from 1 [not at all] to 5 [dominates completely].</p>
<p>The data was collected across 27 locations in the UK, Italy, Spain, the Netherlands, and China. The goal here is to investigate whether these locations can be categorized based on their composition of sound sources.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)  <span class="co"># Data processing and piping</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering libraries</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra) <span class="co"># Clustering and visualisation</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)    <span class="co"># Optimal Number of Clusters</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RCurl)      <span class="co"># For downloading data from Zenodo</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>temp.file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tempfile</span>(), <span class="st">".xlsx"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://zenodo.org/record/5705908/files/SSID%20Lockdown%20Database%20VL0.2.2.xlsx"</span>, temp.file, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(temp.file)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Traffic"</span>, <span class="st">"Other"</span>, <span class="st">"Natural"</span>, <span class="st">"Human"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># vars &lt;- c("pleasant", "chaotic", "vibrant", "uneventful", "calm", "annoying", "eventful", "monotonous")</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Cutdown the dataset</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> ssid.data[<span class="fu">c</span>(<span class="st">"GroupID"</span>, <span class="st">"SessionID"</span>, <span class="st">"LocationID"</span>, vars)]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ssid.data &lt;- subset(ssid.data, Lockdown != 1)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set GroupID, SessionID, Location as factor type</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> ssid.data <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(GroupID, SessionID, LocationID),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">funs</span>(as.factor))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> ssid.data <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(vars),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">funs</span>(as.numeric))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean response for each GroupID</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> ssid.data <span class="sc">%&gt;%</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(GroupID) <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">Traffic =</span> <span class="fu">mean</span>(Traffic, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">Other =</span> <span class="fu">mean</span>(Other, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">Natural =</span> <span class="fu">mean</span>(Natural, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">Human =</span> <span class="fu">mean</span>(Human, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>              <span class="co"># pleasant = mean(pleasant, na.rm = TRUE),</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>              <span class="co"># chaotic = mean(chaotic, na.rm = TRUE),</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>              <span class="co"># vibrant = mean(vibrant, na.rm = TRUE),</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>              <span class="co"># uneventful = mean(uneventful, na.rm = TRUE),</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>              <span class="co"># calm = mean(calm, na.rm = TRUE),</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>              <span class="co"># annoying = mean(annoying, na.rm = TRUE),</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>              <span class="co"># eventful = mean(eventful, na.rm = TRUE),</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>              <span class="co"># monotonous = mean(monotonous, na.rm = TRUE),</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">LocationID =</span> LocationID[<span class="dv">1</span>])</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis.data$LocationID &lt;- unique(ssid.data[c('GroupID', 'LocationID')])['LocationID']</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>ssid.data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(ssid.data)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ssid.data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">GroupID</th>
<th style="text-align: right;">Traffic</th>
<th style="text-align: right;">Other</th>
<th style="text-align: right;">Natural</th>
<th style="text-align: right;">Human</th>
<th style="text-align: left;">LocationID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AM01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">4.000000</td>
<td style="text-align: left;">SanMarco</td>
</tr>
<tr class="even">
<td style="text-align: left;">AM02</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">4.000000</td>
<td style="text-align: left;">SanMarco</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AM03</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">4.666667</td>
<td style="text-align: left;">SanMarco</td>
</tr>
<tr class="even">
<td style="text-align: left;">AM05</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.000000</td>
<td style="text-align: left;">SanMarco</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AM06</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">3.500000</td>
<td style="text-align: left;">SanMarco</td>
</tr>
<tr class="even">
<td style="text-align: left;">AM07</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">4.000000</td>
<td style="text-align: left;">SanMarco</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Our locations are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">levels</span>(ssid.data<span class="sc">$</span>LocationID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CamdenTown"         "EustonTap"          "MarchmontGarden"   
 [4] "MonumentoGaribaldi" "PancrasLock"        "RegentsParkFields" 
 [7] "RegentsParkJapan"   "RussellSq"          "SanMarco"          
[10] "StPaulsCross"       "StPaulsRow"         "TateModern"        
[13] "TorringtonSq"      </code></pre>
</div>
</div>
</section>
<section id="calculate-the-mean-value-for-each-location" class="level2">
<h2 class="anchored" data-anchor-id="calculate-the-mean-value-for-each-location">Calculate the mean value for each Location</h2>
<p><strong>Note:</strong> If the data use different scales, they should always be standardised before clustering. In this case, all of the data are on the same scale, so we don’t need to worry.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(ssid.data[<span class="fu">c</span>(vars)], <span class="at">by=</span><span class="fu">list</span>(ssid.data<span class="sc">$</span>LocationID), <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(means[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">row.names =</span> means[, <span class="dv">1</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(means)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Traffic</th>
<th style="text-align: right;">Other</th>
<th style="text-align: right;">Natural</th>
<th style="text-align: right;">Human</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CamdenTown</td>
<td style="text-align: right;">3.787745</td>
<td style="text-align: right;">2.652941</td>
<td style="text-align: right;">1.316667</td>
<td style="text-align: right;">3.219608</td>
</tr>
<tr class="even">
<td style="text-align: left;">EustonTap</td>
<td style="text-align: right;">3.717857</td>
<td style="text-align: right;">2.858929</td>
<td style="text-align: right;">1.642262</td>
<td style="text-align: right;">2.515476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MarchmontGarden</td>
<td style="text-align: right;">2.663542</td>
<td style="text-align: right;">2.412500</td>
<td style="text-align: right;">2.564583</td>
<td style="text-align: right;">2.695833</td>
</tr>
<tr class="even">
<td style="text-align: left;">MonumentoGaribaldi</td>
<td style="text-align: right;">1.903509</td>
<td style="text-align: right;">1.885965</td>
<td style="text-align: right;">2.982456</td>
<td style="text-align: right;">3.254386</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PancrasLock</td>
<td style="text-align: right;">2.457500</td>
<td style="text-align: right;">3.144167</td>
<td style="text-align: right;">2.391667</td>
<td style="text-align: right;">2.453333</td>
</tr>
<tr class="even">
<td style="text-align: left;">RegentsParkFields</td>
<td style="text-align: right;">2.422886</td>
<td style="text-align: right;">1.911692</td>
<td style="text-align: right;">3.148010</td>
<td style="text-align: right;">2.866915</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RegentsParkJapan</td>
<td style="text-align: right;">1.867179</td>
<td style="text-align: right;">1.528718</td>
<td style="text-align: right;">3.974103</td>
<td style="text-align: right;">2.450000</td>
</tr>
<tr class="even">
<td style="text-align: left;">RussellSq</td>
<td style="text-align: right;">2.668120</td>
<td style="text-align: right;">2.027132</td>
<td style="text-align: right;">3.334302</td>
<td style="text-align: right;">2.987403</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SanMarco</td>
<td style="text-align: right;">1.431852</td>
<td style="text-align: right;">1.895926</td>
<td style="text-align: right;">2.230370</td>
<td style="text-align: right;">4.041852</td>
</tr>
<tr class="even">
<td style="text-align: left;">StPaulsCross</td>
<td style="text-align: right;">2.503704</td>
<td style="text-align: right;">2.000000</td>
<td style="text-align: right;">2.266667</td>
<td style="text-align: right;">3.311111</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StPaulsRow</td>
<td style="text-align: right;">2.527132</td>
<td style="text-align: right;">2.294574</td>
<td style="text-align: right;">1.744186</td>
<td style="text-align: right;">3.368217</td>
</tr>
<tr class="even">
<td style="text-align: left;">TateModern</td>
<td style="text-align: right;">2.541667</td>
<td style="text-align: right;">2.150833</td>
<td style="text-align: right;">2.598333</td>
<td style="text-align: right;">3.660833</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TorringtonSq</td>
<td style="text-align: right;">3.230676</td>
<td style="text-align: right;">2.848068</td>
<td style="text-align: right;">1.957005</td>
<td style="text-align: right;">3.269565</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="clustering-analysis" class="level2">
<h2 class="anchored" data-anchor-id="clustering-analysis">Clustering Analysis</h2>
<section id="some-standard-single-indices" class="level3">
<h3 class="anchored" data-anchor-id="some-standard-single-indices">Some standard, single indices</h3>
<p>Elbow plot (within-sum-of-squares), Silhouette, Gap statistic</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(means, hcut, <span class="at">method=</span><span class="st">"wss"</span>, <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(means, hcut, <span class="at">method=</span><span class="st">"silhouette"</span>, <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(means, hcut, <span class="at">method=</span><span class="st">"gap_stat"</span>, <span class="at">ggtheme=</span><span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, it can be less than obvious how to interpret some of these - where exactly is the ‘elbow’ in the elbow plot? Silhouette pretty clearly says k = 2, but the Gap stat gives k = 1, which isn’t very useful. How do we know which is right?</p>
</section>
<section id="indices-using-nbclust" class="level3">
<h3 class="anchored" data-anchor-id="indices-using-nbclust">30 indices using NbClust</h3>
<p>NbClust</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kl"</span>, <span class="st">"ch"</span>, <span class="st">"ccc"</span>, <span class="st">"cindex"</span>, <span class="st">"db"</span>, <span class="st">"silhouette"</span>, <span class="st">"duda"</span>, <span class="st">"pseudot2"</span>, <span class="st">"ratkowsky"</span>, <span class="st">"ptbiserial"</span>, <span class="st">"gap"</span>, <span class="st">"mcclain"</span>, <span class="st">"gamma"</span>, <span class="st">"gplus"</span>, <span class="st">"tau"</span>,<span class="st">"sdindex"</span>, <span class="st">"sdbw"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">NbClust</span>(<span class="at">data =</span> means, <span class="at">distance=</span><span class="st">'euclidean'</span>, <span class="at">min.nc =</span> <span class="dv">2</span>, <span class="at">max.nc=</span><span class="dv">9</span>, <span class="at">method=</span><span class="st">"ward.D2"</span>, <span class="at">index =</span> <span class="st">"alllong"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pf(beale, pp, df2): NaNs produced</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** : The Hubert index is a graphical method of determining the number of clusters.
                In the plot of Hubert index, we seek a significant knee that corresponds to a 
                significant increase of the value of the measure i.e the significant peak in Hubert
                index second differences plot. 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** : The D index is a graphical method of determining the number of clusters. 
                In the plot of D index, we seek a significant knee (the significant peak in Dindex
                second differences plot) that corresponds to a significant increase of the value of
                the measure. 
 
******************************************************************* 
* Among all indices:                                                
* 9 proposed 2 as the best number of clusters 
* 4 proposed 3 as the best number of clusters 
* 2 proposed 4 as the best number of clusters 
* 1 proposed 5 as the best number of clusters 
* 4 proposed 6 as the best number of clusters 
* 1 proposed 7 as the best number of clusters 
* 2 proposed 8 as the best number of clusters 
* 5 proposed 9 as the best number of clusters 

                   ***** Conclusion *****                            
 
* According to the majority rule, the best number of clusters is  2 
 
 
******************************************************************* </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">KL</th>
<th style="text-align: right;">CH</th>
<th style="text-align: right;">Hartigan</th>
<th style="text-align: right;">CCC</th>
<th style="text-align: right;">Scott</th>
<th style="text-align: right;">Marriot</th>
<th style="text-align: right;">TrCovW</th>
<th style="text-align: right;">TraceW</th>
<th style="text-align: right;">Friedman</th>
<th style="text-align: right;">Rubin</th>
<th style="text-align: right;">Cindex</th>
<th style="text-align: right;">DB</th>
<th style="text-align: right;">Silhouette</th>
<th style="text-align: right;">Duda</th>
<th style="text-align: right;">Pseudot2</th>
<th style="text-align: right;">Beale</th>
<th style="text-align: right;">Ratkowsky</th>
<th style="text-align: right;">Ball</th>
<th style="text-align: right;">Ptbiserial</th>
<th style="text-align: right;">Gap</th>
<th style="text-align: right;">Frey</th>
<th style="text-align: right;">McClain</th>
<th style="text-align: right;">Gamma</th>
<th style="text-align: right;">Gplus</th>
<th style="text-align: right;">Tau</th>
<th style="text-align: right;">Dunn</th>
<th style="text-align: right;">Hubert</th>
<th style="text-align: right;">SDindex</th>
<th style="text-align: right;">Dindex</th>
<th style="text-align: right;">SDbw</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1.0970</td>
<td style="text-align: right;">8.1449</td>
<td style="text-align: right;">6.0597</td>
<td style="text-align: right;">7.5851</td>
<td style="text-align: right;">102.6537</td>
<td style="text-align: right;">30.2615</td>
<td style="text-align: right;">13.4952</td>
<td style="text-align: right;">10.1742</td>
<td style="text-align: right;">351.3546</td>
<td style="text-align: right;">36.9377</td>
<td style="text-align: right;">0.4269</td>
<td style="text-align: right;">0.8174</td>
<td style="text-align: right;">0.3529</td>
<td style="text-align: right;">0.6156</td>
<td style="text-align: right;">4.9946</td>
<td style="text-align: right;">1.3398</td>
<td style="text-align: right;">0.3840</td>
<td style="text-align: right;">5.0871</td>
<td style="text-align: right;">0.5020</td>
<td style="text-align: right;">-0.9326</td>
<td style="text-align: right;">1.0370</td>
<td style="text-align: right;">0.4096</td>
<td style="text-align: right;">0.5903</td>
<td style="text-align: right;">3.7821</td>
<td style="text-align: right;">10.8974</td>
<td style="text-align: right;">0.3539</td>
<td style="text-align: right;">0.0753</td>
<td style="text-align: right;">2.5622</td>
<td style="text-align: right;">0.8042</td>
<td style="text-align: right;">0.4459</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">1.1005</td>
<td style="text-align: right;">8.4961</td>
<td style="text-align: right;">5.2330</td>
<td style="text-align: right;">6.3990</td>
<td style="text-align: right;">119.6026</td>
<td style="text-align: right;">18.4865</td>
<td style="text-align: right;">5.5195</td>
<td style="text-align: right;">6.5603</td>
<td style="text-align: right;">404.1006</td>
<td style="text-align: right;">57.2860</td>
<td style="text-align: right;">0.3951</td>
<td style="text-align: right;">1.0948</td>
<td style="text-align: right;">0.2818</td>
<td style="text-align: right;">0.4299</td>
<td style="text-align: right;">5.3038</td>
<td style="text-align: right;">2.5609</td>
<td style="text-align: right;">0.4103</td>
<td style="text-align: right;">2.1868</td>
<td style="text-align: right;">0.4710</td>
<td style="text-align: right;">-1.6230</td>
<td style="text-align: right;">0.2765</td>
<td style="text-align: right;">1.3913</td>
<td style="text-align: right;">0.6265</td>
<td style="text-align: right;">3.1026</td>
<td style="text-align: right;">10.4103</td>
<td style="text-align: right;">0.3626</td>
<td style="text-align: right;">0.0800</td>
<td style="text-align: right;">2.8643</td>
<td style="text-align: right;">0.6523</td>
<td style="text-align: right;">0.3387</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">1.6303</td>
<td style="text-align: right;">9.3352</td>
<td style="text-align: right;">3.5123</td>
<td style="text-align: right;">5.9285</td>
<td style="text-align: right;">136.6838</td>
<td style="text-align: right;">8.8328</td>
<td style="text-align: right;">2.0114</td>
<td style="text-align: right;">4.3066</td>
<td style="text-align: right;">514.5025</td>
<td style="text-align: right;">87.2635</td>
<td style="text-align: right;">0.5492</td>
<td style="text-align: right;">0.8335</td>
<td style="text-align: right;">0.3286</td>
<td style="text-align: right;">2.5977</td>
<td style="text-align: right;">-1.2301</td>
<td style="text-align: right;">-0.9899</td>
<td style="text-align: right;">0.4303</td>
<td style="text-align: right;">1.0767</td>
<td style="text-align: right;">0.4840</td>
<td style="text-align: right;">-1.8404</td>
<td style="text-align: right;">0.2171</td>
<td style="text-align: right;">2.0924</td>
<td style="text-align: right;">0.7560</td>
<td style="text-align: right;">1.5513</td>
<td style="text-align: right;">9.6154</td>
<td style="text-align: right;">0.5689</td>
<td style="text-align: right;">0.0773</td>
<td style="text-align: right;">2.4025</td>
<td style="text-align: right;">0.5465</td>
<td style="text-align: right;">0.2559</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: right;">0.8819</td>
<td style="text-align: right;">9.4327</td>
<td style="text-align: right;">4.1056</td>
<td style="text-align: right;">5.4008</td>
<td style="text-align: right;">150.1412</td>
<td style="text-align: right;">4.9017</td>
<td style="text-align: right;">0.9988</td>
<td style="text-align: right;">3.0977</td>
<td style="text-align: right;">615.3276</td>
<td style="text-align: right;">121.3182</td>
<td style="text-align: right;">0.5171</td>
<td style="text-align: right;">0.6492</td>
<td style="text-align: right;">0.4032</td>
<td style="text-align: right;">2.6324</td>
<td style="text-align: right;">-1.2402</td>
<td style="text-align: right;">-0.9981</td>
<td style="text-align: right;">0.4026</td>
<td style="text-align: right;">0.6195</td>
<td style="text-align: right;">0.4854</td>
<td style="text-align: right;">-2.3510</td>
<td style="text-align: right;">0.1834</td>
<td style="text-align: right;">2.4726</td>
<td style="text-align: right;">0.8391</td>
<td style="text-align: right;">0.8718</td>
<td style="text-align: right;">9.0897</td>
<td style="text-align: right;">0.6139</td>
<td style="text-align: right;">0.0863</td>
<td style="text-align: right;">2.3482</td>
<td style="text-align: right;">0.4455</td>
<td style="text-align: right;">0.1689</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: right;">2.4474</td>
<td style="text-align: right;">10.7100</td>
<td style="text-align: right;">1.9565</td>
<td style="text-align: right;">5.2900</td>
<td style="text-align: right;">170.5431</td>
<td style="text-align: right;">1.4694</td>
<td style="text-align: right;">0.3679</td>
<td style="text-align: right;">2.0471</td>
<td style="text-align: right;">969.8285</td>
<td style="text-align: right;">183.5792</td>
<td style="text-align: right;">0.5973</td>
<td style="text-align: right;">0.5852</td>
<td style="text-align: right;">0.4719</td>
<td style="text-align: right;">1.8668</td>
<td style="text-align: right;">-0.4643</td>
<td style="text-align: right;">-0.5605</td>
<td style="text-align: right;">0.3812</td>
<td style="text-align: right;">0.3412</td>
<td style="text-align: right;">0.4830</td>
<td style="text-align: right;">-2.4797</td>
<td style="text-align: right;">0.5241</td>
<td style="text-align: right;">2.9403</td>
<td style="text-align: right;">0.9529</td>
<td style="text-align: right;">0.2051</td>
<td style="text-align: right;">8.3077</td>
<td style="text-align: right;">0.8559</td>
<td style="text-align: right;">0.1062</td>
<td style="text-align: right;">2.4432</td>
<td style="text-align: right;">0.3528</td>
<td style="text-align: right;">0.1185</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.9458</td>
<td style="text-align: right;">10.0676</td>
<td style="text-align: right;">1.9696</td>
<td style="text-align: right;">4.5460</td>
<td style="text-align: right;">183.1309</td>
<td style="text-align: right;">0.7595</td>
<td style="text-align: right;">0.2213</td>
<td style="text-align: right;">1.5999</td>
<td style="text-align: right;">1194.4928</td>
<td style="text-align: right;">234.8889</td>
<td style="text-align: right;">0.5305</td>
<td style="text-align: right;">0.5508</td>
<td style="text-align: right;">0.4589</td>
<td style="text-align: right;">3.4939</td>
<td style="text-align: right;">-0.7138</td>
<td style="text-align: right;">-0.8616</td>
<td style="text-align: right;">0.3578</td>
<td style="text-align: right;">0.2286</td>
<td style="text-align: right;">0.4476</td>
<td style="text-align: right;">-2.9193</td>
<td style="text-align: right;">0.8670</td>
<td style="text-align: right;">3.6092</td>
<td style="text-align: right;">0.9643</td>
<td style="text-align: right;">0.1282</td>
<td style="text-align: right;">6.9231</td>
<td style="text-align: right;">0.8905</td>
<td style="text-align: right;">0.1153</td>
<td style="text-align: right;">3.0849</td>
<td style="text-align: right;">0.2980</td>
<td style="text-align: right;">0.0970</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: right;">0.9554</td>
<td style="text-align: right;">9.7863</td>
<td style="text-align: right;">2.1072</td>
<td style="text-align: right;">4.5678</td>
<td style="text-align: right;">213.5276</td>
<td style="text-align: right;">0.0957</td>
<td style="text-align: right;">0.1542</td>
<td style="text-align: right;">1.2045</td>
<td style="text-align: right;">3652.8265</td>
<td style="text-align: right;">311.9964</td>
<td style="text-align: right;">0.4860</td>
<td style="text-align: right;">0.4826</td>
<td style="text-align: right;">0.5005</td>
<td style="text-align: right;">3.0804</td>
<td style="text-align: right;">-0.6754</td>
<td style="text-align: right;">-0.8152</td>
<td style="text-align: right;">0.3386</td>
<td style="text-align: right;">0.1506</td>
<td style="text-align: right;">0.3947</td>
<td style="text-align: right;">-3.0908</td>
<td style="text-align: right;">0.5258</td>
<td style="text-align: right;">4.8153</td>
<td style="text-align: right;">0.9537</td>
<td style="text-align: right;">0.1282</td>
<td style="text-align: right;">5.2821</td>
<td style="text-align: right;">0.7320</td>
<td style="text-align: right;">0.1161</td>
<td style="text-align: right;">3.2357</td>
<td style="text-align: right;">0.2402</td>
<td style="text-align: right;">0.0697</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td style="text-align: right;">0.9437</td>
<td style="text-align: right;">9.9481</td>
<td style="text-align: right;">2.5926</td>
<td style="text-align: right;">3.7773</td>
<td style="text-align: right;">235.4352</td>
<td style="text-align: right;">0.0225</td>
<td style="text-align: right;">0.0873</td>
<td style="text-align: right;">0.8474</td>
<td style="text-align: right;">6052.3637</td>
<td style="text-align: right;">443.4830</td>
<td style="text-align: right;">0.4147</td>
<td style="text-align: right;">0.4100</td>
<td style="text-align: right;">0.5619</td>
<td style="text-align: right;">4.7507</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.3219</td>
<td style="text-align: right;">0.0942</td>
<td style="text-align: right;">0.3339</td>
<td style="text-align: right;">-3.4867</td>
<td style="text-align: right;">0.1666</td>
<td style="text-align: right;">7.0102</td>
<td style="text-align: right;">0.9662</td>
<td style="text-align: right;">0.0641</td>
<td style="text-align: right;">3.6667</td>
<td style="text-align: right;">0.7386</td>
<td style="text-align: right;">0.1163</td>
<td style="text-align: right;">3.4232</td>
<td style="text-align: right;">0.1907</td>
<td style="text-align: right;">0.0490</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CritValue_Duda</th>
<th style="text-align: right;">CritValue_PseudoT2</th>
<th style="text-align: right;">Fvalue_Beale</th>
<th style="text-align: right;">CritValue_Gap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">0.2019</td>
<td style="text-align: right;">31.6230</td>
<td style="text-align: right;">0.2766</td>
<td style="text-align: right;">0.7534</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">0.0160</td>
<td style="text-align: right;">246.4030</td>
<td style="text-align: right;">0.0787</td>
<td style="text-align: right;">0.2949</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">-0.1694</td>
<td style="text-align: right;">-13.8056</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.6048</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: right;">-0.1694</td>
<td style="text-align: right;">-13.8056</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.2346</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: right;">-0.3257</td>
<td style="text-align: right;">-4.0703</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.5672</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: right;">-0.3257</td>
<td style="text-align: right;">-4.0703</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.3163</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: right;">-0.3257</td>
<td style="text-align: right;">-4.0703</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.5663</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td style="text-align: right;">-0.5879</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">0.3864</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">KL</th>
<th style="text-align: right;">CH</th>
<th style="text-align: right;">Hartigan</th>
<th style="text-align: right;">CCC</th>
<th style="text-align: right;">Scott</th>
<th style="text-align: right;">Marriot</th>
<th style="text-align: right;">TrCovW</th>
<th style="text-align: right;">TraceW</th>
<th style="text-align: right;">Friedman</th>
<th style="text-align: right;">Rubin</th>
<th style="text-align: right;">Cindex</th>
<th style="text-align: right;">DB</th>
<th style="text-align: right;">Silhouette</th>
<th style="text-align: right;">Duda</th>
<th style="text-align: right;">PseudoT2</th>
<th style="text-align: right;">Beale</th>
<th style="text-align: right;">Ratkowsky</th>
<th style="text-align: right;">Ball</th>
<th style="text-align: right;">PtBiserial</th>
<th style="text-align: right;">Gap</th>
<th style="text-align: right;">Frey</th>
<th style="text-align: right;">McClain</th>
<th style="text-align: right;">Gamma</th>
<th style="text-align: right;">Gplus</th>
<th style="text-align: right;">Tau</th>
<th style="text-align: right;">Dunn</th>
<th style="text-align: right;">Hubert</th>
<th style="text-align: right;">SDindex</th>
<th style="text-align: right;">Dindex</th>
<th style="text-align: right;">SDbw</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Number_clusters</td>
<td style="text-align: right;">6.0000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">6.0000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">8.0000</td>
<td style="text-align: right;">4.0000</td>
<td style="text-align: right;">3.0000</td>
<td style="text-align: right;">3.0000</td>
<td style="text-align: right;">8.000</td>
<td style="text-align: right;">6.0000</td>
<td style="text-align: right;">3.0000</td>
<td style="text-align: right;">9.00</td>
<td style="text-align: right;">9.0000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">4.0000</td>
<td style="text-align: right;">3.0000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">9.0000</td>
<td style="text-align: right;">9.0000</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">7.0000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.0000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Value_Index</td>
<td style="text-align: right;">2.4474</td>
<td style="text-align: right;">10.71</td>
<td style="text-align: right;">2.1492</td>
<td style="text-align: right;">7.5851</td>
<td style="text-align: right;">30.3968</td>
<td style="text-align: right;">5.7226</td>
<td style="text-align: right;">7.9756</td>
<td style="text-align: right;">1.3603</td>
<td style="text-align: right;">2458.334</td>
<td style="text-align: right;">-10.9512</td>
<td style="text-align: right;">0.3951</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.5619</td>
<td style="text-align: right;">0.6156</td>
<td style="text-align: right;">4.9946</td>
<td style="text-align: right;">1.3398</td>
<td style="text-align: right;">0.4303</td>
<td style="text-align: right;">2.9003</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">-0.9326</td>
<td style="text-align: right;">1.037</td>
<td style="text-align: right;">0.4096</td>
<td style="text-align: right;">0.9662</td>
<td style="text-align: right;">0.0641</td>
<td style="text-align: right;">10.8974</td>
<td style="text-align: right;">0.8905</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.3482</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.049</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CamdenTown</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">EustonTap</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MarchmontGarden</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">MonumentoGaribaldi</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PancrasLock</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">RegentsParkFields</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RegentsParkJapan</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">RussellSq</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SanMarco</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">StPaulsCross</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StPaulsRow</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">TateModern</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TorringtonSq</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in if (class(best_nc) == "numeric") print(best_nc) else if (class(best_nc) == : the condition has length &gt; 1</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>k.fit <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(means, k)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(k.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in as.data.frame.default(x): cannot coerce class '"kmeans"' to a data.frame</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(k.fit, means, <span class="at">repel=</span><span class="cn">TRUE</span>, <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>res.pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(means, <span class="at">scale=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">facto_summarize</span>(res.pca, <span class="st">"var"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           name      Dim.1      Dim.2     coord      cos2  contrib
Traffic Traffic -0.8891690 -0.1531570 0.8140785 0.8140785 22.70701
Other     Other -0.9153206 -0.1088317 0.8496561 0.8496561 23.69937
Natural Natural  0.8316428 -0.5046107 0.9462617 0.9462617 26.39398
Human     Human  0.1897201  0.9690987 0.9751460 0.9751460 27.19965</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(res.pca, <span class="st">"var"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">eclust</span>(means, <span class="st">"kmeans"</span>, <span class="at">k=</span>k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>h.fit <span class="ot">&lt;-</span> <span class="fu">eclust</span>(means, <span class="st">"hclust"</span>, <span class="at">k=</span>k, <span class="at">stand =</span> T, <span class="at">hc_method =</span> <span class="st">"ward.D2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as
of ggplot2 3.3.4.
ℹ The deprecated feature was likely used in the factoextra package.
  Please report the issue at &lt;https://github.com/kassambara/factoextra/issues&gt;.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(h.fit, <span class="at">labels_track_height =</span> <span class="fl">2.5</span>, <span class="at">horiz=</span><span class="cn">TRUE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="methods-i-havent-really-tested-out-thoroughly" class="level2">
<h2 class="anchored" data-anchor-id="methods-i-havent-really-tested-out-thoroughly">Methods I haven’t really tested out thoroughly</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(res.pca, <span class="at">repel=</span>T,<span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="fviz_silhouette" class="level3">
<h3 class="anchored" data-anchor-id="fviz_silhouette"><code>fviz_silhouette()</code></h3>
<p>Silhouette (Si) analysis is a cluster validation approach that measures how well an observation is clustered and it estimates the average distance between clusters.</p>
<p><strong>Details</strong></p>
<ul>
<li>Observations with a large silhouette Si (almost 1) are very well clustered</li>
<li>A small Si (around 0) means that the observation lies between two clusters</li>
<li>Observations with a negative Si are probably placed in the wrong cluster</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_silhouette</span>(h.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1    5          0.32
2       2    8          0.32</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="get_clust_tendency" class="level3">
<h3 class="anchored" data-anchor-id="get_clust_tendency"><code>get_clust_tendency</code></h3>
<p>Before applying cluster methods, the first step is to assess whether the data is clusterable, a process defined as the <strong>assessing of clustering tendency</strong>. <code>get_clust_tendency()</code> assesses clustering tendency using Hopkins’ statistic and a visual approach.</p>
<p><strong>Details</strong></p>
<p><strong>Hopkins Statistic:</strong> If the value of Hopkins statistic is close to 1 (far above 0.5), then we can conclude that the dataset is significantly clusterable.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$hopkins_stat
[1] 0.6977892

$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mitchell2020,
  author = {Mitchell, Andrew},
  title = {Clustering Analysis in {R,} with `Factoextra` and
    {`NbClust`}},
  date = {2020-06-18},
  url = {https://drandrewmitchell.com/posts/2020-06-18_cluster-analysis-in-r/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mitchell2020" class="csl-entry quarto-appendix-citeas" role="listitem">
Mitchell, Andrew. 2020. <span>“Clustering Analysis in R, with
`Factoextra` and `NbClust`.”</span> June 18, 2020. <a href="https://drandrewmitchell.com/posts/2020-06-18_cluster-analysis-in-r/">https://drandrewmitchell.com/posts/2020-06-18_cluster-analysis-in-r/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/drandrewmitchell\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>